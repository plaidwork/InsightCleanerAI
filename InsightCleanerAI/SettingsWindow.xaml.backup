<Window x:Class="InsightCleanerAI.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:infra="clr-namespace:InsightCleanerAI.Infrastructure"
        xmlns:models="clr-namespace:InsightCleanerAI.Models"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        xmlns:res="clr-namespace:InsightCleanerAI.Resources"
        Title="{x:Static res:Strings.SettingsTitle}"
        Height="680"
        Width="720"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize">
    <Window.Resources>
        <ObjectDataProvider x:Key="PrivacyModes"
                            MethodName="GetValues"
                            ObjectType="{x:Type sys:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="models:PrivacyMode" />
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
        <ObjectDataProvider x:Key="AiModes"
                            MethodName="GetValues"
                            ObjectType="{x:Type sys:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="models:AiMode" />
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
        <ObjectDataProvider x:Key="InquiryScopes"
                            MethodName="GetValues"
                            ObjectType="{x:Type sys:Enum}">
            <ObjectDataProvider.MethodParameters>
                <x:Type TypeName="models:InquiryScope" />
            </ObjectDataProvider.MethodParameters>
        </ObjectDataProvider>
        <infra:AiModeLabelConverter x:Key="AiModeLabelConverter" />
        <infra:InquiryScopeLabelConverter x:Key="InquiryScopeLabelConverter" />
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="190" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <TextBlock Grid.Row="0"
                   Grid.ColumnSpan="2"
                   Text="{x:Static res:Strings.SectionBasicsTitle}"
                   FontSize="18"
                   FontWeight="Bold"
                   Margin="0,0,0,12" />

        <TextBlock Grid.Row="1"
                   Grid.Column="0"
                   VerticalAlignment="Center"
                   Text="{x:Static res:Strings.LabelPrivacyMode}" />
        <ComboBox Grid.Row="1"
                  Grid.Column="1"
                  ItemsSource="{Binding Source={StaticResource PrivacyModes}}"
                  SelectedItem="{Binding SelectedPrivacyMode}" />

        <TextBlock Grid.Row="2"
                   Grid.Column="0"
                   VerticalAlignment="Center"
                   Text="{x:Static res:Strings.LabelAiMode}" />
        <ComboBox Grid.Row="2"
                  Grid.Column="1"
                  ItemsSource="{Binding Source={StaticResource AiModes}}"
                  SelectedItem="{Binding SelectedAiMode, Mode=TwoWay}">
            <ComboBox.ItemTemplate>
                <DataTemplate>
                    <TextBlock Text="{Binding Converter={StaticResource AiModeLabelConverter}}" />
                </DataTemplate>
            </ComboBox.ItemTemplate>
        </ComboBox>

        <TextBlock Grid.Row="3"
                   Grid.Column="0"
                   VerticalAlignment="Center"
                   Text="{x:Static res:Strings.LabelInquiryScope}" />
        <ComboBox Grid.Row="3"
                  Grid.Column="1"
                  ItemsSource="{Binding Source={StaticResource InquiryScopes}}"
                  SelectedItem="{Binding InquiryScope}">
            <ComboBox.ItemTemplate>
                <DataTemplate>
                    <TextBlock Text="{Binding Converter={StaticResource InquiryScopeLabelConverter}}" />
                </DataTemplate>
            </ComboBox.ItemTemplate>
        </ComboBox>

        <TextBlock Grid.Row="4"
                   Grid.Column="0"
                   VerticalAlignment="Center"
                   Text="{x:Static res:Strings.LabelCloudApiKey}" />
        <PasswordBox Grid.Row="4"
                     Grid.Column="1"
                     PasswordChanged="ApiKeyBox_OnPasswordChanged" />

        <TextBlock Grid.Row="5"
                   Grid.Column="0"
                   VerticalAlignment="Center"
                   Text="{x:Static res:Strings.LabelCloudEndpoint}" />
        <TextBox Grid.Row="5"
                 Grid.Column="1"
                 Text="{Binding RemoteServerUrl, UpdateSourceTrigger=PropertyChanged}" />

        <TextBlock Grid.Row="6"
                   Grid.Column="0"
                   VerticalAlignment="Center"
                   Text="{x:Static res:Strings.LabelCloudModel}" />
        <StackPanel Grid.Row="6"
                    Grid.Column="1"
                    Orientation="Horizontal">
            <ComboBox Width="340"
                      IsEditable="True"
                      ItemsSource="{Binding CloudModels}"
                      Text="{Binding CloudModel, UpdateSourceTrigger=PropertyChanged}" />
            <Button Content="获取模型"
                    Margin="8,0,0,0"
                    Padding="12,2"
                    Click="FetchCloudModelsButton_Click">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="IsEnabled" Value="True" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsLoadingCloudModels}" Value="True">
                                <Setter Property="IsEnabled" Value="False" />
                                <Setter Property="Content" Value="加载中..." />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </StackPanel>

        <TextBlock Grid.Row="7"
                   Grid.Column="0"
                   VerticalAlignment="Center"
                   Text="{x:Static res:Strings.LabelCloudRequestTimeout}" />
        <TextBox Grid.Row="7"
                 Grid.Column="1"
                 Text="{Binding CloudRequestTimeoutSeconds, UpdateSourceTrigger=PropertyChanged}" />

        <TextBlock Grid.Row="8"
                   Grid.Column="0"
                   VerticalAlignment="Center"
                   Text="{x:Static res:Strings.LabelCloudConcurrency}" />
        <TextBox Grid.Row="8"
                 Grid.Column="1"
                 Text="{Binding CloudConcurrencyLimit, UpdateSourceTrigger=PropertyChanged}" />

        <TextBlock Grid.Row="9"
                   Grid.Column="0"
                   VerticalAlignment="Center"
                   Text="{x:Static res:Strings.LabelAiBatchSize}" />
        <TextBox Grid.Row="9"
                 Grid.Column="1"
                 Text="{Binding AiBatchSize, UpdateSourceTrigger=PropertyChanged}" />

        <TextBlock Grid.Row="10"
                   Grid.Column="0"
                   VerticalAlignment="Center"
                   Text="{x:Static res:Strings.LabelAiTotalLimit}" />
        <TextBox Grid.Row="10"
                 Grid.Column="1"
                 Text="{Binding AiTotalLimit, UpdateSourceTrigger=PropertyChanged}" />

        <TextBlock Grid.Row="11"
                   Grid.Column="0"
                   VerticalAlignment="Center"
                   Text="{x:Static res:Strings.LabelSearchApiEndpoint}" />
        <TextBox Grid.Row="11"
                 Grid.Column="1"
                 Text="{Binding SearchApiEndpoint, UpdateSourceTrigger=PropertyChanged}" />

        <TextBlock Grid.Row="12"
                   Grid.Column="0"
                   VerticalAlignment="Center"
                   Text="{x:Static res:Strings.LabelSearchApiKey}" />
        <PasswordBox Grid.Row="12"
                     Grid.Column="1"
                     PasswordChanged="SearchApiKeyBox_OnPasswordChanged" />

        <TextBlock Grid.Row="13"
                   Grid.Column="0"
                   VerticalAlignment="Center"
                   Text="{x:Static res:Strings.LabelLocalLlmEndpoint}" />
        <TextBox Grid.Row="13"
                 Grid.Column="1"
                 IsEnabled="{Binding IsLocalLlmConfigEnabled}"
                 Text="{Binding LocalLlmEndpoint, UpdateSourceTrigger=PropertyChanged}" />

        <TextBlock Grid.Row="14"
                   Grid.Column="0"
                   VerticalAlignment="Center"
                   Text="{x:Static res:Strings.LabelLocalLlmModel}" />
        <StackPanel Grid.Row="14"
                    Grid.Column="1"
                    Orientation="Horizontal">
            <ComboBox Width="340"
                      IsEditable="True"
                      IsEnabled="{Binding IsLocalLlmConfigEnabled}"
                      ItemsSource="{Binding LocalModels}"
                      Text="{Binding LocalLlmModel, UpdateSourceTrigger=PropertyChanged}" />
            <Button Content="获取模型"
                    Margin="8,0,0,0"
                    Padding="12,2"
                    Click="FetchLocalModelsButton_Click">
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="IsEnabled" Value="{Binding IsLocalLlmConfigEnabled}" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsLoadingLocalModels}" Value="True">
                                <Setter Property="IsEnabled" Value="False" />
                                <Setter Property="Content" Value="加载中..." />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </StackPanel>

        <TextBlock Grid.Row="15"
                   Grid.Column="0"
                   VerticalAlignment="Center"
                   Text="{x:Static res:Strings.LabelLocalLlmApiKey}" />
        <PasswordBox Grid.Row="15"
                     Grid.Column="1"
                     IsEnabled="{Binding IsLocalLlmConfigEnabled}"
                     PasswordChanged="LocalLlmApiKeyBox_OnPasswordChanged" />

        <TextBlock Grid.Row="16"
                   Grid.Column="0"
                   VerticalAlignment="Center"
                   Text="{x:Static res:Strings.LabelMaxDepth}" />
        <TextBox Grid.Row="16"
                 Grid.Column="1"
                 Text="{Binding MaxDepth, UpdateSourceTrigger=PropertyChanged}" />

        <TextBlock Grid.Row="17"
                   Grid.Column="0"
                   VerticalAlignment="Center"
                   Text="{x:Static res:Strings.LabelMaxNodes}" />
        <StackPanel Grid.Row="17"
                    Grid.Column="1"
                    Orientation="Horizontal">
            <TextBox Width="140"
                     Text="{Binding MaxNodes, UpdateSourceTrigger=PropertyChanged}" />
            <Button Content="{x:Static res:Strings.ButtonMax}"
                    Margin="8,0,0,0"
                    Padding="12,2"
                    Click="MaxNodesButton_Click" />
        </StackPanel>

        <TextBlock Grid.Row="18"
                   Grid.Column="0"
                   VerticalAlignment="Center"
                   Text="{x:Static res:Strings.LabelDelayPerNode}" />
        <TextBox Grid.Row="18"
                 Grid.Column="1"
                 Text="{Binding DelayPerNodeMs, UpdateSourceTrigger=PropertyChanged}" />

        <TextBlock Grid.Row="19"
                   Grid.Column="0"
                   VerticalAlignment="Center"
                   Text="{x:Static res:Strings.LabelCacheDirectory}" />
        <StackPanel Grid.Row="19"
                    Grid.Column="1"
                    Orientation="Horizontal">
            <TextBox Width="360"
                     Text="{Binding CacheDirectory, UpdateSourceTrigger=PropertyChanged}" />
            <Button Content="{x:Static res:Strings.ButtonBrowse}"
                    Margin="8,0,0,0"
                    Padding="12,2"
                    Click="BrowseCacheButton_Click" />
        </StackPanel>

        <TextBlock Grid.Row="20"
                   Grid.Column="0"
                   VerticalAlignment="Center"
                   Text="{x:Static res:Strings.LabelDatabasePath}" />
        <StackPanel Grid.Row="20"
                    Grid.Column="1"
                    Orientation="Horizontal">
            <TextBox Width="360"
                     Text="{Binding DatabasePath, UpdateSourceTrigger=PropertyChanged}" />
            <Button Content="{x:Static res:Strings.ButtonBrowse}"
                    Margin="8,0,0,0"
                    Padding="12,2"
                    Click="BrowseDatabaseButton_Click" />
            <Button Content="{x:Static res:Strings.ClearCacheButton}"
                    Margin="8,0,0,0"
                    Padding="12,2"
                    Click="ClearCacheButton_Click" />
        </StackPanel>

        <TextBlock Grid.Row="21"
                   Grid.Column="0"
                   VerticalAlignment="Center"
                   Text="{x:Static res:Strings.LabelIgnoreCacheSize}" />
        <CheckBox Grid.Row="21"
                  Grid.Column="1"
                  Content="{x:Static res:Strings.CheckboxIgnoreCacheSize}"
                  IsChecked="{Binding IgnoreCacheSize}" />

        <CheckBox Grid.Row="22"
                  Grid.Column="0"
                  Grid.ColumnSpan="2"
                  Margin="0,12,0,0"
                  Content="{x:Static res:Strings.CheckboxPersistApiKeys}"
                  IsChecked="{Binding PersistApiKeys}" />

        <CheckBox Grid.Row="23"
                  Grid.Column="0"
                  Grid.ColumnSpan="2"
                  Margin="0,12,0,0"
                  Content="{x:Static res:Strings.CheckboxIncludeHidden}"
                  IsChecked="{Binding IncludeHidden}" />

        <StackPanel Grid.Row="24"
                    Grid.ColumnSpan="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,20,0,0">
            <Button Content="{x:Static res:Strings.SaveDefaultsButton}"
                    Width="140"
                    Margin="0,0,8,0"
                    Click="SaveDefaultsButton_Click" />
            <Button Content="{x:Static res:Strings.CloseButton}"
                    Width="80"
                    IsDefault="True"
                    Click="CloseButton_Click" />
        </StackPanel>
    </Grid>
</Window>
